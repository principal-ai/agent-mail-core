{
  "pv": {
    "name": "Agent Mail Core - DI Architecture",
    "version": "1.0.0"
  },
  "nodes": [
    {
      "id": "index.ts",
      "type": "rectangle",
      "x": 300,
      "y": 50,
      "width": 120,
      "height": 60,
      "color": "#9b59b6",
      "pv": {
        "nodeType": "entry_point",
        "shape": "rectangle",
        "description": "Universal exports for all environments"
      }
    },
    {
      "id": "node.ts",
      "type": "rectangle",
      "x": 450,
      "y": 50,
      "width": 120,
      "height": 60,
      "color": "#27ae60",
      "pv": {
        "nodeType": "entry_point",
        "shape": "rectangle",
        "description": "Node.js-specific entry point"
      }
    },
    {
      "id": "browser.ts",
      "type": "rectangle",
      "x": 600,
      "y": 50,
      "width": 120,
      "height": 60,
      "color": "#3498db",
      "pv": {
        "nodeType": "entry_point",
        "shape": "rectangle",
        "description": "Browser-specific entry point"
      }
    },
    {
      "id": "Node.js Adapters",
      "type": "rectangle",
      "x": 100,
      "y": 180,
      "width": 160,
      "height": 100,
      "color": "#27ae60",
      "pv": {
        "nodeType": "adapter_layer",
        "shape": "rectangle",
        "description": "better-sqlite3, fs, proper-lockfile, fast-glob"
      }
    },
    {
      "id": "Browser Adapters",
      "type": "rectangle",
      "x": 300,
      "y": 180,
      "width": 160,
      "height": 100,
      "color": "#3498db",
      "pv": {
        "nodeType": "adapter_layer",
        "shape": "rectangle",
        "description": "sql.js, IndexedDB, navigator.locks, micromatch"
      }
    },
    {
      "id": "Test Adapters",
      "type": "rectangle",
      "x": 500,
      "y": 180,
      "width": 160,
      "height": 100,
      "color": "#e74c3c",
      "pv": {
        "nodeType": "adapter_layer",
        "shape": "rectangle",
        "description": "In-memory mocks for unit testing"
      }
    },
    {
      "id": "DatabaseAdapter",
      "type": "hexagon",
      "x": 100,
      "y": 350,
      "width": 140,
      "height": 70,
      "color": "#1abc9c",
      "pv": {
        "nodeType": "abstraction",
        "shape": "hexagon",
        "description": "Interface: run, get, all, transaction"
      }
    },
    {
      "id": "StorageAdapter",
      "type": "hexagon",
      "x": 260,
      "y": 350,
      "width": 140,
      "height": 70,
      "color": "#1abc9c",
      "pv": {
        "nodeType": "abstraction",
        "shape": "hexagon",
        "description": "Interface: readFile, writeFile, git ops"
      }
    },
    {
      "id": "LockAdapter",
      "type": "hexagon",
      "x": 420,
      "y": 350,
      "width": 140,
      "height": 70,
      "color": "#1abc9c",
      "pv": {
        "nodeType": "abstraction",
        "shape": "hexagon",
        "description": "Interface: acquire, release, isLocked"
      }
    },
    {
      "id": "GlobAdapter",
      "type": "hexagon",
      "x": 580,
      "y": 350,
      "width": 140,
      "height": 70,
      "color": "#1abc9c",
      "pv": {
        "nodeType": "abstraction",
        "shape": "hexagon",
        "description": "Interface: findFiles, matches"
      }
    },
    {
      "id": "AgentMailCore",
      "type": "rectangle",
      "x": 300,
      "y": 480,
      "width": 200,
      "height": 80,
      "color": "#e74c3c",
      "pv": {
        "nodeType": "core_class",
        "shape": "rectangle",
        "description": "Main class with constructor injection"
      }
    },
    {
      "id": "Models",
      "type": "rectangle",
      "x": 100,
      "y": 620,
      "width": 120,
      "height": 60,
      "color": "#f39c12",
      "pv": {
        "nodeType": "domain",
        "shape": "rectangle",
        "description": "Project, Agent, Message, FileReservation"
      }
    },
    {
      "id": "Operations",
      "type": "rectangle",
      "x": 250,
      "y": 620,
      "width": 120,
      "height": 60,
      "color": "#f39c12",
      "pv": {
        "nodeType": "domain",
        "shape": "rectangle",
        "description": "send, receive, reserve, contact"
      }
    },
    {
      "id": "Types",
      "type": "rectangle",
      "x": 400,
      "y": 620,
      "width": 120,
      "height": 60,
      "color": "#f39c12",
      "pv": {
        "nodeType": "domain",
        "shape": "rectangle",
        "description": "Config, enums, shared interfaces"
      }
    },
    {
      "id": "Validation",
      "type": "rectangle",
      "x": 550,
      "y": 620,
      "width": 120,
      "height": 60,
      "color": "#f39c12",
      "pv": {
        "nodeType": "domain",
        "shape": "rectangle",
        "description": "Agent names, patterns, input"
      }
    }
  ],
  "edges": [
    {
      "id": "node_to_node_adapters",
      "fromNode": "node.ts",
      "toNode": "Node.js Adapters",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "exports",
      "color": "#27ae60",
      "pv": {
        "edgeType": "export"
      }
    },
    {
      "id": "browser_to_browser_adapters",
      "fromNode": "browser.ts",
      "toNode": "Browser Adapters",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "exports",
      "color": "#3498db",
      "pv": {
        "edgeType": "export"
      }
    },
    {
      "id": "index_to_test_adapters",
      "fromNode": "index.ts",
      "toNode": "Test Adapters",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "exports",
      "color": "#9b59b6",
      "pv": {
        "edgeType": "export"
      }
    },
    {
      "id": "node_adapters_to_database",
      "fromNode": "Node.js Adapters",
      "toNode": "DatabaseAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "node_adapters_to_storage",
      "fromNode": "Node.js Adapters",
      "toNode": "StorageAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "browser_adapters_to_database",
      "fromNode": "Browser Adapters",
      "toNode": "DatabaseAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "browser_adapters_to_storage",
      "fromNode": "Browser Adapters",
      "toNode": "StorageAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "browser_adapters_to_lock",
      "fromNode": "Browser Adapters",
      "toNode": "LockAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "browser_adapters_to_glob",
      "fromNode": "Browser Adapters",
      "toNode": "GlobAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "test_adapters_to_lock",
      "fromNode": "Test Adapters",
      "toNode": "LockAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "test_adapters_to_glob",
      "fromNode": "Test Adapters",
      "toNode": "GlobAdapter",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "implements",
      "color": "#1abc9c",
      "pv": {
        "edgeType": "implements"
      }
    },
    {
      "id": "database_to_core",
      "fromNode": "DatabaseAdapter",
      "toNode": "AgentMailCore",
      "fromSide": "bottom",
      "toSide": "left",
      "label": "injected",
      "color": "#e74c3c",
      "pv": {
        "edgeType": "dependency_injection"
      }
    },
    {
      "id": "storage_to_core",
      "fromNode": "StorageAdapter",
      "toNode": "AgentMailCore",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "injected",
      "color": "#e74c3c",
      "pv": {
        "edgeType": "dependency_injection"
      }
    },
    {
      "id": "lock_to_core",
      "fromNode": "LockAdapter",
      "toNode": "AgentMailCore",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "injected",
      "color": "#e74c3c",
      "pv": {
        "edgeType": "dependency_injection"
      }
    },
    {
      "id": "glob_to_core",
      "fromNode": "GlobAdapter",
      "toNode": "AgentMailCore",
      "fromSide": "bottom",
      "toSide": "right",
      "label": "injected",
      "color": "#e74c3c",
      "pv": {
        "edgeType": "dependency_injection"
      }
    },
    {
      "id": "core_to_models",
      "fromNode": "AgentMailCore",
      "toNode": "Models",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "uses",
      "color": "#f39c12",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "core_to_operations",
      "fromNode": "AgentMailCore",
      "toNode": "Operations",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "uses",
      "color": "#f39c12",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "core_to_types",
      "fromNode": "AgentMailCore",
      "toNode": "Types",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "uses",
      "color": "#f39c12",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "core_to_validation",
      "fromNode": "AgentMailCore",
      "toNode": "Validation",
      "fromSide": "bottom",
      "toSide": "top",
      "label": "uses",
      "color": "#f39c12",
      "pv": {
        "edgeType": "uses"
      }
    }
  ]
}
